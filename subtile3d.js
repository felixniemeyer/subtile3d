var subtile3d=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=16)}([function(e,t){e.exports={sourceCode:"#version 300 es \nlayout(location=0)in vec2 vert;out vec2 st;void main(){gl_Position=vec4(vert,0,1);st=(vert+vec2(1,1))*0.5;}",uniforms:{},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es\nprecision mediump float;uniform float time;uniform float turbulence;in vec2 st;out vec4 vertex;vec4 A(vec4 B){return B-floor(B*(1./289.))*289.;}vec3 A(vec3 B){return B-floor(B*(1./289.))*289.;}vec4 C(vec4 B){return fract(B*((34./289.)*B+(1./289.)))*289.;}vec4 D(vec4 B){return fract(B*(7./288.));}vec4 E(vec2 F){vec4 G=A(vec4(F.xy,F.xy+1.));return D(C(C(G.xzxz)+G.yyww));}float H(in vec2 st){vec2 I=floor(st);vec2 J=fract(st);vec4 K=E(I);vec2 L=J*J*(3.-2.*J);return mix(K.x,K.y,L.x)+(K.z-K.x)*L.y*(1.-L.x)+(K.w-K.y)*L.x*L.y-0.5;}\n#define M 5\n#define N \n#define O -0.80901699\n#define P 0.587785\nfloat Q(in vec2 st){float R=0.5;float S=.5;vec2 T=vec2(0.3,0.2);const mat2 U=mat2(O,P,-P,O);for(int I=0;I<M;I++){R+=S*H(st+time*T/float(I+5)*5.);st*=2.;S*=turbulence;T=U*T;}return R;}void main(){vec2 V=st*5.;vertex.xyz=vec3(Q(V),Q(V+231.3219),Q(V-98.12));vertex.w=Q(V+123.1);}",uniforms:{time:{variableType:"float",variableName:"time"},turbulence:{variableType:"float",variableName:"turbulence"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es \nlayout(location=0)in vec2 vert;out vec2 ts;void main(){gl_Position=vec4(vert,0,1);ts=(vert+vec2(1))*0.5;}",uniforms:{},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es \nprecision mediump float;uniform sampler2D plasmaTex;uniform int quadCountSqrt;uniform float vertexCountSqrtInverse;uniform float quadCountSqrtInverse;uniform float cameraSpread;uniform float flatness;uniform float shape;uniform mat4 prismSide00A;uniform mat4 prismSide00B;uniform mat4 prismSide01A;uniform mat4 prismSide01B;uniform mat4 prismSide10A;uniform mat4 prismSide10B;uniform mat4 prismSide11A;uniform mat4 prismSide11B;uniform mat4 camera;in vec2 ts;layout(location=0)out vec4 v0;layout(location=1)out vec4 v1;layout(location=2)out vec4 v2;layout(location=3)out vec4 lookAt;void main(){ivec2 A=ivec2(ts*vec2(2,1)*float(quadCountSqrt));ivec2 B[3];if(A.x>=quadCountSqrt){A.x-=quadCountSqrt;B[0]=ivec2(1,0);B[1]=ivec2(1,1);B[2]=ivec2(0,1);}else{B[0]=ivec2(0,0);B[1]=ivec2(1,0);B[2]=ivec2(0,1);}vec2 C[3];vec3 D[3];vec4 E[3];vec3 F[3];for(int G=0;G<3;G++){C[G]=(vec2(A+B[G])+vec2(0.5))*vertexCountSqrtInverse;E[G]=texture(plasmaTex,C[G]);D[G]=vec3(vec2(A+B[G])*quadCountSqrtInverse,0)*2.-vec3(1,1,0);}mat4 H;vec2 I=D[0].xy+(D[1].xy+D[2].xy-2.*D[0].xy)*0.333;float J=I.x+I.y;vec3 K;int L=quadCountSqrt/2;if(A.y<L){if(A.x<L){if(J<-1.){H=prismSide00A;K=vec3(-1,-1,-1);}else{H=prismSide00B;K=vec3(0,0,-1);}}else{if(J<0.){H=prismSide10A;K=vec3(0,-1,0);}else{H=prismSide10B;K=vec3(1,0,0);}}}else{if(A.x<L){if(J<0.){H=prismSide01A;K=vec3(-1,0,0);}else{H=prismSide01B;K=vec3(0,1,0);}}else{if(J<1.){H=prismSide11A;K=vec3(0,0,1);}else{H=prismSide11B;K=vec3(1,1,1);}}}vec3 M[3];vec3 N;float O;for(int G=0;G<3;G++){M[G]=(H*vec4(D[G],1)).xyz;}float P=(E[0].w+E[1].w+E[2].w)*0.333;float Q=0.5;float R,S;for(int G=0;G<3;G++){R=clamp(((E[G].w+P*4.)*0.2-0.5)*2.5+0.5,0.,1.)*Q;S=smoothstep(R,R+(1.-Q),shape);N.x=abs(D[G].x-K.x);N.y=abs(D[G].y-K.y);N.z=abs(D[G].x+D[G].y-K.z);O=pow(N.x*N.y*N.z,0.3333);D[G]=(1.-S)*D[G]+S*M[G];D[G]+=((1.-S)+S*O)*(E[G].xyz-vec3(0.5,0.5,0.5))*4.*quadCountSqrtInverse;}vec3 T=D[1]-D[0];vec3 U=D[2]-D[0];lookAt=vec4(normalize(cross(T,U)),1);for(int G=0;G<3;G++){vec4 V=camera*vec4(D[G],1);D[G]=vec3(V.x/(-V.z*cameraSpread),V.y/(-V.z*cameraSpread),V.z);}int W,X;vec2 Y,Z;float a[3];for(int G=0;G<3;G++){W=G+1>2?0:G+1;X=G+2>2?G-1:2;vec2 Y=normalize(D[X].xy-D[W].xy);vec2 Z=D[W].xy-D[G].xy;a[G]=length(Z-dot(Z,Y)*Y);}v0=vec4(D[0],a[0]);v1=vec4(D[1],a[1]);v2=vec4(D[2],a[2]);}",uniforms:{plasmaTex:{variableType:"sampler2D",variableName:"plasmaTex"},quadCountSqrt:{variableType:"int",variableName:"quadCountSqrt"},vertexCountSqrtInverse:{variableType:"float",variableName:"vertexCountSqrtInverse"},quadCountSqrtInverse:{variableType:"float",variableName:"quadCountSqrtInverse"},cameraSpread:{variableType:"float",variableName:"cameraSpread"},flatness:{variableType:"float",variableName:"flatness"},shape:{variableType:"float",variableName:"shape"},prismSide00A:{variableType:"mat4",variableName:"prismSide00A"},prismSide00B:{variableType:"mat4",variableName:"prismSide00B"},prismSide01A:{variableType:"mat4",variableName:"prismSide01A"},prismSide01B:{variableType:"mat4",variableName:"prismSide01B"},prismSide10A:{variableType:"mat4",variableName:"prismSide10A"},prismSide10B:{variableType:"mat4",variableName:"prismSide10B"},prismSide11A:{variableType:"mat4",variableName:"prismSide11A"},prismSide11B:{variableType:"mat4",variableName:"prismSide11B"},camera:{variableType:"mat4",variableName:"camera"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es\nlayout(location=0)in uint vert;uniform sampler2D geoTexV0;uniform sampler2D geoTexV1;uniform sampler2D geoTexV2;uniform sampler2D geoTexLookAt;uniform int quadCountSqrt;uniform float quadCountSqrtInverse;out vec3 edgeDistances;out float z;out vec3 normal;int A(in int a,in int div){return a-(a/div)*div;}void main(){int B=gl_VertexID/6;int C=gl_VertexID-B*6;vec2 D;D.y=float(B/quadCountSqrt);D.x=float(B)-D.y*float(quadCountSqrt);D=(D+vec2(0.5))*quadCountSqrtInverse;D.x=D.x*0.5;if(C>2){C-=3;D.x+=0.5;}vec4 E;if(C==0){E=texture(geoTexV0,D);}else if(C==1){E=texture(geoTexV1,D);}else{E=texture(geoTexV2,D);}vec4 F=texture(geoTexLookAt,D);gl_Position=vec4(E.xy,-E.z*0.1,1);normal=normalize(F.xyz);edgeDistances=vec3(0,0,0);edgeDistances[C]=E.w;z=E.z;}",uniforms:{geoTexV0:{variableType:"sampler2D",variableName:"geoTexV0"},geoTexV1:{variableType:"sampler2D",variableName:"geoTexV1"},geoTexV2:{variableType:"sampler2D",variableName:"geoTexV2"},geoTexLookAt:{variableType:"sampler2D",variableName:"geoTexLookAt"},quadCountSqrt:{variableType:"int",variableName:"quadCountSqrt"},quadCountSqrtInverse:{variableType:"float",variableName:"quadCountSqrtInverse"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es \nprecision mediump float;const vec3 A=0.8*vec3(0.80,0.,0.5);uniform float pixelSize;uniform float progress;uniform float borderSize;uniform float borderZWeight;uniform float cells;uniform float cellSize;uniform float fog;uniform float resolutionInverse;in vec3 edgeDistances;in float z;in vec3 normal;out vec4 fragColor;void main(){vec3 B=A;if(gl_FrontFacing){B+=normal*0.2;B+=vec3(-0.8,0,0.1)*clamp(dot(vec3(1,0,0),normal),0.,1.);B+=vec3(0.4,0.4,1.8)*clamp(dot(vec3(0.3,1.,0.1),normal),0.,1.);B+=vec3(0.7,0.,0.)*clamp(dot(vec3(-0.1,-0.6,-0.3),normal),0.,1.);}else{B*=0.33;}float C=smoothstep(0.3,1.,length(gl_FragCoord.xy*resolutionInverse*2.-vec2(1)));float D=borderSize+borderZWeight*z;float E=min(min(edgeDistances.x,edgeDistances.y),edgeDistances.z);float F=pow(edgeDistances.x*edgeDistances.y*edgeDistances.z,0.333)*cellSize;float G=(1.-cells)+cells*smoothstep(C,C+0.44/(C+1.),smoothstep(0.1,1.01,F));float H=max(0.,(z+1.85-fog)*smoothstep(D,D-2.*pixelSize,E));H=H*H;B=pow(B,vec3(0.6545));fragColor=vec4(B,H*G);}",uniforms:{pixelSize:{variableType:"float",variableName:"pixelSize"},progress:{variableType:"float",variableName:"progress"},borderSize:{variableType:"float",variableName:"borderSize"},borderZWeight:{variableType:"float",variableName:"borderZWeight"},cells:{variableType:"float",variableName:"cells"},cellSize:{variableType:"float",variableName:"cellSize"},fog:{variableType:"float",variableName:"fog"},resolutionInverse:{variableType:"float",variableName:"resolutionInverse"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es\nlayout(location=0)in vec2 vert;uniform vec2 position;uniform vec2 size;out vec2 ts;void main(){ts=(vert+vec2(1,1))*0.5;gl_Position=vec4(((position+ts*size)-vec2(0.5))*vec2(2,-2),0,1);}",uniforms:{position:{variableType:"vec2",variableName:"position"},size:{variableType:"vec2",variableName:"size"}},consts:{}}},function(e,t){e.exports={sourceCode:"#version 300 es \nprecision mediump float;uniform sampler2D tex;uniform vec4 valueShift;uniform vec4 valueScale;in vec2 ts;out vec4 fragColor;void main(){fragColor=(texture(tex,ts)+valueShift)*valueScale;}",uniforms:{tex:{variableType:"sampler2D",variableName:"tex"},valueShift:{variableType:"vec4",variableName:"valueShift"},valueScale:{variableType:"vec4",variableName:"valueScale"}},consts:{}}},,,,,,,,,function(e,t,r){"use strict";r.r(t);var a={};r.r(a),r.d(a,"EPSILON",(function(){return A})),r.d(a,"ARRAY_TYPE",(function(){return R})),r.d(a,"RANDOM",(function(){return D})),r.d(a,"setMatrixArrayType",(function(){return G})),r.d(a,"toRadian",(function(){return _})),r.d(a,"equals",(function(){return L}));var n={};function o(e,t,r,a){var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(n);return console.error("*** Error compiling shader '"+n+"':"+o),e.deleteShader(n),null}return n}r.r(n),r.d(n,"create",(function(){return B})),r.d(n,"clone",(function(){return F})),r.d(n,"copy",(function(){return N})),r.d(n,"fromValues",(function(){return P})),r.d(n,"set",(function(){return q})),r.d(n,"identity",(function(){return I})),r.d(n,"transpose",(function(){return U})),r.d(n,"invert",(function(){return w})),r.d(n,"adjoint",(function(){return z})),r.d(n,"determinant",(function(){return O})),r.d(n,"multiply",(function(){return V})),r.d(n,"translate",(function(){return X})),r.d(n,"scale",(function(){return H})),r.d(n,"rotate",(function(){return K})),r.d(n,"rotateX",(function(){return W})),r.d(n,"rotateY",(function(){return Y})),r.d(n,"rotateZ",(function(){return Z})),r.d(n,"fromTranslation",(function(){return k})),r.d(n,"fromScaling",(function(){return Q})),r.d(n,"fromRotation",(function(){return J})),r.d(n,"fromXRotation",(function(){return j})),r.d(n,"fromYRotation",(function(){return $})),r.d(n,"fromZRotation",(function(){return ee})),r.d(n,"fromRotationTranslation",(function(){return te})),r.d(n,"fromQuat2",(function(){return re})),r.d(n,"getTranslation",(function(){return ae})),r.d(n,"getScaling",(function(){return ne})),r.d(n,"getRotation",(function(){return oe})),r.d(n,"fromRotationTranslationScale",(function(){return ie})),r.d(n,"fromRotationTranslationScaleOrigin",(function(){return ue})),r.d(n,"fromQuat",(function(){return se})),r.d(n,"frustum",(function(){return le})),r.d(n,"perspective",(function(){return ce})),r.d(n,"perspectiveFromFieldOfView",(function(){return fe})),r.d(n,"ortho",(function(){return me})),r.d(n,"lookAt",(function(){return ve})),r.d(n,"targetTo",(function(){return de})),r.d(n,"str",(function(){return be})),r.d(n,"frob",(function(){return pe})),r.d(n,"add",(function(){return he})),r.d(n,"subtract",(function(){return Te})),r.d(n,"multiplyScalar",(function(){return Me})),r.d(n,"multiplyScalarAndAdd",(function(){return ge})),r.d(n,"exactEquals",(function(){return xe})),r.d(n,"equals",(function(){return Se})),r.d(n,"mul",(function(){return ye})),r.d(n,"sub",(function(){return Ee}));var i=["VERTEX_SHADER","FRAGMENT_SHADER"];function u(e,t,r,a,n){for(var u=[],s=0;s<t.length;++s)u.push(o(e,t[s],e[i[s]]));return function(e,t,r,a,n){var o=e.createProgram();if(t.forEach((function(t){e.attachShader(o,t)})),r&&r.forEach((function(t,r){e.bindAttribLocation(o,a?a[r]:r,t)})),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var i=e.getProgramInfoLog(o);return console.error("Error in program linking:"+i),e.deleteProgram(o),null}return o}(e,u,r,a)}var s=r(0),l=r.n(s),c=r(1),f=r.n(c),m=r(2),v=r.n(m),d=r(3),b=r.n(d),p=r(4),h=r.n(p),T=r(5),M=r.n(T),g=r(6),x=r.n(g),S=r(7),y=r.n(S);const E=(e,t,r)=>{var a,n={};for(a in r)n[a]=e.getUniformLocation(t,a);return n};var A=1e-6,R="undefined"!=typeof Float32Array?Float32Array:Array,D=Math.random;function G(e){R=e}var C=Math.PI/180;function _(e){return e*C}function L(e,t){return Math.abs(e-t)<=A*Math.max(1,Math.abs(e),Math.abs(t))}function B(){var e=new R(16);return R!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function F(e){var t=new R(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function N(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function P(e,t,r,a,n,o,i,u,s,l,c,f,m,v,d,b){var p=new R(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=a,p[4]=n,p[5]=o,p[6]=i,p[7]=u,p[8]=s,p[9]=l,p[10]=c,p[11]=f,p[12]=m,p[13]=v,p[14]=d,p[15]=b,p}function q(e,t,r,a,n,o,i,u,s,l,c,f,m,v,d,b,p){return e[0]=t,e[1]=r,e[2]=a,e[3]=n,e[4]=o,e[5]=i,e[6]=u,e[7]=s,e[8]=l,e[9]=c,e[10]=f,e[11]=m,e[12]=v,e[13]=d,e[14]=b,e[15]=p,e}function I(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function U(e,t){if(e===t){var r=t[1],a=t[2],n=t[3],o=t[6],i=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=a,e[9]=o,e[11]=t[14],e[12]=n,e[13]=i,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function w(e,t){var r=t[0],a=t[1],n=t[2],o=t[3],i=t[4],u=t[5],s=t[6],l=t[7],c=t[8],f=t[9],m=t[10],v=t[11],d=t[12],b=t[13],p=t[14],h=t[15],T=r*u-a*i,M=r*s-n*i,g=r*l-o*i,x=a*s-n*u,S=a*l-o*u,y=n*l-o*s,E=c*b-f*d,A=c*p-m*d,R=c*h-v*d,D=f*p-m*b,G=f*h-v*b,C=m*h-v*p,_=T*C-M*G+g*D+x*R-S*A+y*E;return _?(_=1/_,e[0]=(u*C-s*G+l*D)*_,e[1]=(n*G-a*C-o*D)*_,e[2]=(b*y-p*S+h*x)*_,e[3]=(m*S-f*y-v*x)*_,e[4]=(s*R-i*C-l*A)*_,e[5]=(r*C-n*R+o*A)*_,e[6]=(p*g-d*y-h*M)*_,e[7]=(c*y-m*g+v*M)*_,e[8]=(i*G-u*R+l*E)*_,e[9]=(a*R-r*G-o*E)*_,e[10]=(d*S-b*g+h*T)*_,e[11]=(f*g-c*S-v*T)*_,e[12]=(u*A-i*D-s*E)*_,e[13]=(r*D-a*A+n*E)*_,e[14]=(b*M-d*x-p*T)*_,e[15]=(c*x-f*M+m*T)*_,e):null}function z(e,t){var r=t[0],a=t[1],n=t[2],o=t[3],i=t[4],u=t[5],s=t[6],l=t[7],c=t[8],f=t[9],m=t[10],v=t[11],d=t[12],b=t[13],p=t[14],h=t[15];return e[0]=u*(m*h-v*p)-f*(s*h-l*p)+b*(s*v-l*m),e[1]=-(a*(m*h-v*p)-f*(n*h-o*p)+b*(n*v-o*m)),e[2]=a*(s*h-l*p)-u*(n*h-o*p)+b*(n*l-o*s),e[3]=-(a*(s*v-l*m)-u*(n*v-o*m)+f*(n*l-o*s)),e[4]=-(i*(m*h-v*p)-c*(s*h-l*p)+d*(s*v-l*m)),e[5]=r*(m*h-v*p)-c*(n*h-o*p)+d*(n*v-o*m),e[6]=-(r*(s*h-l*p)-i*(n*h-o*p)+d*(n*l-o*s)),e[7]=r*(s*v-l*m)-i*(n*v-o*m)+c*(n*l-o*s),e[8]=i*(f*h-v*b)-c*(u*h-l*b)+d*(u*v-l*f),e[9]=-(r*(f*h-v*b)-c*(a*h-o*b)+d*(a*v-o*f)),e[10]=r*(u*h-l*b)-i*(a*h-o*b)+d*(a*l-o*u),e[11]=-(r*(u*v-l*f)-i*(a*v-o*f)+c*(a*l-o*u)),e[12]=-(i*(f*p-m*b)-c*(u*p-s*b)+d*(u*m-s*f)),e[13]=r*(f*p-m*b)-c*(a*p-n*b)+d*(a*m-n*f),e[14]=-(r*(u*p-s*b)-i*(a*p-n*b)+d*(a*s-n*u)),e[15]=r*(u*m-s*f)-i*(a*m-n*f)+c*(a*s-n*u),e}function O(e){var t=e[0],r=e[1],a=e[2],n=e[3],o=e[4],i=e[5],u=e[6],s=e[7],l=e[8],c=e[9],f=e[10],m=e[11],v=e[12],d=e[13],b=e[14],p=e[15];return(t*i-r*o)*(f*p-m*b)-(t*u-a*o)*(c*p-m*d)+(t*s-n*o)*(c*b-f*d)+(r*u-a*i)*(l*p-m*v)-(r*s-n*i)*(l*b-f*v)+(a*s-n*u)*(l*d-c*v)}function V(e,t,r){var a=t[0],n=t[1],o=t[2],i=t[3],u=t[4],s=t[5],l=t[6],c=t[7],f=t[8],m=t[9],v=t[10],d=t[11],b=t[12],p=t[13],h=t[14],T=t[15],M=r[0],g=r[1],x=r[2],S=r[3];return e[0]=M*a+g*u+x*f+S*b,e[1]=M*n+g*s+x*m+S*p,e[2]=M*o+g*l+x*v+S*h,e[3]=M*i+g*c+x*d+S*T,M=r[4],g=r[5],x=r[6],S=r[7],e[4]=M*a+g*u+x*f+S*b,e[5]=M*n+g*s+x*m+S*p,e[6]=M*o+g*l+x*v+S*h,e[7]=M*i+g*c+x*d+S*T,M=r[8],g=r[9],x=r[10],S=r[11],e[8]=M*a+g*u+x*f+S*b,e[9]=M*n+g*s+x*m+S*p,e[10]=M*o+g*l+x*v+S*h,e[11]=M*i+g*c+x*d+S*T,M=r[12],g=r[13],x=r[14],S=r[15],e[12]=M*a+g*u+x*f+S*b,e[13]=M*n+g*s+x*m+S*p,e[14]=M*o+g*l+x*v+S*h,e[15]=M*i+g*c+x*d+S*T,e}function X(e,t,r){var a,n,o,i,u,s,l,c,f,m,v,d,b=r[0],p=r[1],h=r[2];return t===e?(e[12]=t[0]*b+t[4]*p+t[8]*h+t[12],e[13]=t[1]*b+t[5]*p+t[9]*h+t[13],e[14]=t[2]*b+t[6]*p+t[10]*h+t[14],e[15]=t[3]*b+t[7]*p+t[11]*h+t[15]):(a=t[0],n=t[1],o=t[2],i=t[3],u=t[4],s=t[5],l=t[6],c=t[7],f=t[8],m=t[9],v=t[10],d=t[11],e[0]=a,e[1]=n,e[2]=o,e[3]=i,e[4]=u,e[5]=s,e[6]=l,e[7]=c,e[8]=f,e[9]=m,e[10]=v,e[11]=d,e[12]=a*b+u*p+f*h+t[12],e[13]=n*b+s*p+m*h+t[13],e[14]=o*b+l*p+v*h+t[14],e[15]=i*b+c*p+d*h+t[15]),e}function H(e,t,r){var a=r[0],n=r[1],o=r[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function K(e,t,r,a){var n,o,i,u,s,l,c,f,m,v,d,b,p,h,T,M,g,x,S,y,E,R,D,G,C=a[0],_=a[1],L=a[2],B=Math.hypot(C,_,L);return B<A?null:(C*=B=1/B,_*=B,L*=B,n=Math.sin(r),i=1-(o=Math.cos(r)),u=t[0],s=t[1],l=t[2],c=t[3],f=t[4],m=t[5],v=t[6],d=t[7],b=t[8],p=t[9],h=t[10],T=t[11],M=C*C*i+o,g=_*C*i+L*n,x=L*C*i-_*n,S=C*_*i-L*n,y=_*_*i+o,E=L*_*i+C*n,R=C*L*i+_*n,D=_*L*i-C*n,G=L*L*i+o,e[0]=u*M+f*g+b*x,e[1]=s*M+m*g+p*x,e[2]=l*M+v*g+h*x,e[3]=c*M+d*g+T*x,e[4]=u*S+f*y+b*E,e[5]=s*S+m*y+p*E,e[6]=l*S+v*y+h*E,e[7]=c*S+d*y+T*E,e[8]=u*R+f*D+b*G,e[9]=s*R+m*D+p*G,e[10]=l*R+v*D+h*G,e[11]=c*R+d*D+T*G,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function W(e,t,r){var a=Math.sin(r),n=Math.cos(r),o=t[4],i=t[5],u=t[6],s=t[7],l=t[8],c=t[9],f=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+l*a,e[5]=i*n+c*a,e[6]=u*n+f*a,e[7]=s*n+m*a,e[8]=l*n-o*a,e[9]=c*n-i*a,e[10]=f*n-u*a,e[11]=m*n-s*a,e}function Y(e,t,r){var a=Math.sin(r),n=Math.cos(r),o=t[0],i=t[1],u=t[2],s=t[3],l=t[8],c=t[9],f=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-l*a,e[1]=i*n-c*a,e[2]=u*n-f*a,e[3]=s*n-m*a,e[8]=o*a+l*n,e[9]=i*a+c*n,e[10]=u*a+f*n,e[11]=s*a+m*n,e}function Z(e,t,r){var a=Math.sin(r),n=Math.cos(r),o=t[0],i=t[1],u=t[2],s=t[3],l=t[4],c=t[5],f=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+l*a,e[1]=i*n+c*a,e[2]=u*n+f*a,e[3]=s*n+m*a,e[4]=l*n-o*a,e[5]=c*n-i*a,e[6]=f*n-u*a,e[7]=m*n-s*a,e}function k(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Q(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function J(e,t,r){var a,n,o,i=r[0],u=r[1],s=r[2],l=Math.hypot(i,u,s);return l<A?null:(i*=l=1/l,u*=l,s*=l,a=Math.sin(t),o=1-(n=Math.cos(t)),e[0]=i*i*o+n,e[1]=u*i*o+s*a,e[2]=s*i*o-u*a,e[3]=0,e[4]=i*u*o-s*a,e[5]=u*u*o+n,e[6]=s*u*o+i*a,e[7]=0,e[8]=i*s*o+u*a,e[9]=u*s*o-i*a,e[10]=s*s*o+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function j(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ee(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function te(e,t,r){var a=t[0],n=t[1],o=t[2],i=t[3],u=a+a,s=n+n,l=o+o,c=a*u,f=a*s,m=a*l,v=n*s,d=n*l,b=o*l,p=i*u,h=i*s,T=i*l;return e[0]=1-(v+b),e[1]=f+T,e[2]=m-h,e[3]=0,e[4]=f-T,e[5]=1-(c+b),e[6]=d+p,e[7]=0,e[8]=m+h,e[9]=d-p,e[10]=1-(c+v),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function re(e,t){var r=new R(3),a=-t[0],n=-t[1],o=-t[2],i=t[3],u=t[4],s=t[5],l=t[6],c=t[7],f=a*a+n*n+o*o+i*i;return f>0?(r[0]=2*(u*i+c*a+s*o-l*n)/f,r[1]=2*(s*i+c*n+l*a-u*o)/f,r[2]=2*(l*i+c*o+u*n-s*a)/f):(r[0]=2*(u*i+c*a+s*o-l*n),r[1]=2*(s*i+c*n+l*a-u*o),r[2]=2*(l*i+c*o+u*n-s*a)),te(e,t,r),e}function ae(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ne(e,t){var r=t[0],a=t[1],n=t[2],o=t[4],i=t[5],u=t[6],s=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(r,a,n),e[1]=Math.hypot(o,i,u),e[2]=Math.hypot(s,l,c),e}function oe(e,t){var r=new R(3);ne(r,t);var a=1/r[0],n=1/r[1],o=1/r[2],i=t[0]*a,u=t[1]*n,s=t[2]*o,l=t[4]*a,c=t[5]*n,f=t[6]*o,m=t[8]*a,v=t[9]*n,d=t[10]*o,b=i+c+d,p=0;return b>0?(p=2*Math.sqrt(b+1),e[3]=.25*p,e[0]=(f-v)/p,e[1]=(m-s)/p,e[2]=(u-l)/p):i>c&&i>d?(p=2*Math.sqrt(1+i-c-d),e[3]=(f-v)/p,e[0]=.25*p,e[1]=(u+l)/p,e[2]=(m+s)/p):c>d?(p=2*Math.sqrt(1+c-i-d),e[3]=(m-s)/p,e[0]=(u+l)/p,e[1]=.25*p,e[2]=(f+v)/p):(p=2*Math.sqrt(1+d-i-c),e[3]=(u-l)/p,e[0]=(m+s)/p,e[1]=(f+v)/p,e[2]=.25*p),e}function ie(e,t,r,a){var n=t[0],o=t[1],i=t[2],u=t[3],s=n+n,l=o+o,c=i+i,f=n*s,m=n*l,v=n*c,d=o*l,b=o*c,p=i*c,h=u*s,T=u*l,M=u*c,g=a[0],x=a[1],S=a[2];return e[0]=(1-(d+p))*g,e[1]=(m+M)*g,e[2]=(v-T)*g,e[3]=0,e[4]=(m-M)*x,e[5]=(1-(f+p))*x,e[6]=(b+h)*x,e[7]=0,e[8]=(v+T)*S,e[9]=(b-h)*S,e[10]=(1-(f+d))*S,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ue(e,t,r,a,n){var o=t[0],i=t[1],u=t[2],s=t[3],l=o+o,c=i+i,f=u+u,m=o*l,v=o*c,d=o*f,b=i*c,p=i*f,h=u*f,T=s*l,M=s*c,g=s*f,x=a[0],S=a[1],y=a[2],E=n[0],A=n[1],R=n[2],D=(1-(b+h))*x,G=(v+g)*x,C=(d-M)*x,_=(v-g)*S,L=(1-(m+h))*S,B=(p+T)*S,F=(d+M)*y,N=(p-T)*y,P=(1-(m+b))*y;return e[0]=D,e[1]=G,e[2]=C,e[3]=0,e[4]=_,e[5]=L,e[6]=B,e[7]=0,e[8]=F,e[9]=N,e[10]=P,e[11]=0,e[12]=r[0]+E-(D*E+_*A+F*R),e[13]=r[1]+A-(G*E+L*A+N*R),e[14]=r[2]+R-(C*E+B*A+P*R),e[15]=1,e}function se(e,t){var r=t[0],a=t[1],n=t[2],o=t[3],i=r+r,u=a+a,s=n+n,l=r*i,c=a*i,f=a*u,m=n*i,v=n*u,d=n*s,b=o*i,p=o*u,h=o*s;return e[0]=1-f-d,e[1]=c+h,e[2]=m-p,e[3]=0,e[4]=c-h,e[5]=1-l-d,e[6]=v+b,e[7]=0,e[8]=m+p,e[9]=v-b,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function le(e,t,r,a,n,o,i){var u=1/(r-t),s=1/(n-a),l=1/(o-i);return e[0]=2*o*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*s,e[6]=0,e[7]=0,e[8]=(r+t)*u,e[9]=(n+a)*s,e[10]=(i+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*l,e[15]=0,e}function ce(e,t,r,a,n){var o,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(o=1/(a-n),e[10]=(n+a)*o,e[14]=2*n*a*o):(e[10]=-1,e[14]=-2*a),e}function fe(e,t,r,a){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(i+u),l=2/(n+o);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(i-u)*s*.5,e[9]=(n-o)*l*.5,e[10]=a/(r-a),e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r/(r-a),e[15]=0,e}function me(e,t,r,a,n,o,i){var u=1/(t-r),s=1/(a-n),l=1/(o-i);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*u,e[13]=(n+a)*s,e[14]=(i+o)*l,e[15]=1,e}function ve(e,t,r,a){var n,o,i,u,s,l,c,f,m,v,d=t[0],b=t[1],p=t[2],h=a[0],T=a[1],M=a[2],g=r[0],x=r[1],S=r[2];return Math.abs(d-g)<A&&Math.abs(b-x)<A&&Math.abs(p-S)<A?I(e):(c=d-g,f=b-x,m=p-S,n=T*(m*=v=1/Math.hypot(c,f,m))-M*(f*=v),o=M*(c*=v)-h*m,i=h*f-T*c,(v=Math.hypot(n,o,i))?(n*=v=1/v,o*=v,i*=v):(n=0,o=0,i=0),u=f*i-m*o,s=m*n-c*i,l=c*o-f*n,(v=Math.hypot(u,s,l))?(u*=v=1/v,s*=v,l*=v):(u=0,s=0,l=0),e[0]=n,e[1]=u,e[2]=c,e[3]=0,e[4]=o,e[5]=s,e[6]=f,e[7]=0,e[8]=i,e[9]=l,e[10]=m,e[11]=0,e[12]=-(n*d+o*b+i*p),e[13]=-(u*d+s*b+l*p),e[14]=-(c*d+f*b+m*p),e[15]=1,e)}function de(e,t,r,a){var n=t[0],o=t[1],i=t[2],u=a[0],s=a[1],l=a[2],c=n-r[0],f=o-r[1],m=i-r[2],v=c*c+f*f+m*m;v>0&&(c*=v=1/Math.sqrt(v),f*=v,m*=v);var d=s*m-l*f,b=l*c-u*m,p=u*f-s*c;return(v=d*d+b*b+p*p)>0&&(d*=v=1/Math.sqrt(v),b*=v,p*=v),e[0]=d,e[1]=b,e[2]=p,e[3]=0,e[4]=f*p-m*b,e[5]=m*d-c*p,e[6]=c*b-f*d,e[7]=0,e[8]=c,e[9]=f,e[10]=m,e[11]=0,e[12]=n,e[13]=o,e[14]=i,e[15]=1,e}function be(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function pe(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function he(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Te(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Me(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function ge(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e[2]=t[2]+r[2]*a,e[3]=t[3]+r[3]*a,e[4]=t[4]+r[4]*a,e[5]=t[5]+r[5]*a,e[6]=t[6]+r[6]*a,e[7]=t[7]+r[7]*a,e[8]=t[8]+r[8]*a,e[9]=t[9]+r[9]*a,e[10]=t[10]+r[10]*a,e[11]=t[11]+r[11]*a,e[12]=t[12]+r[12]*a,e[13]=t[13]+r[13]*a,e[14]=t[14]+r[14]*a,e[15]=t[15]+r[15]*a,e}function xe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Se(e,t){var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],u=e[5],s=e[6],l=e[7],c=e[8],f=e[9],m=e[10],v=e[11],d=e[12],b=e[13],p=e[14],h=e[15],T=t[0],M=t[1],g=t[2],x=t[3],S=t[4],y=t[5],E=t[6],R=t[7],D=t[8],G=t[9],C=t[10],_=t[11],L=t[12],B=t[13],F=t[14],N=t[15];return Math.abs(r-T)<=A*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(a-M)<=A*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(n-g)<=A*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-x)<=A*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(i-S)<=A*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(u-y)<=A*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(s-E)<=A*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(l-R)<=A*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(c-D)<=A*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(f-G)<=A*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(m-C)<=A*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(v-_)<=A*Math.max(1,Math.abs(v),Math.abs(_))&&Math.abs(d-L)<=A*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(b-B)<=A*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(p-F)<=A*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(h-N)<=A*Math.max(1,Math.abs(h),Math.abs(N))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ye=V,Ee=Te;function Ae(e){const t=Math.pow(2,5),r=t+1,a=(Math.pow(r,2),Math.pow(t,2));let o=void 0;const i=[],s=[];let c;const m=()=>{c=function(e){var t={},r={};return console.log("building shader","genPlasma"),t.genPlasma=u(e,[l.a.sourceCode,f.a.sourceCode]),r.genPlasma=E(e,t.genPlasma,{...l.a.uniforms,...f.a.uniforms}),console.log("building shader","genGeo"),t.genGeo=u(e,[v.a.sourceCode,b.a.sourceCode]),r.genGeo=E(e,t.genGeo,{...v.a.uniforms,...b.a.uniforms}),console.log("building shader","renderGeo"),t.renderGeo=u(e,[h.a.sourceCode,M.a.sourceCode]),r.renderGeo=E(e,t.renderGeo,{...h.a.uniforms,...M.a.uniforms}),console.log("building shader","dbgTex"),t.dbgTex=u(e,[x.a.sourceCode,y.a.sourceCode]),r.dbgTex=E(e,t.dbgTex,{...x.a.uniforms,...y.a.uniforms}),{progs:t,uniLocs:r}}(o),o.useProgram(c.progs.genGeo),o.uniform1i(c.uniLocs.genGeo.quadCountSqrt,t),o.uniform1f(c.uniLocs.genGeo.vertexCountSqrtInverse,1/r),o.uniform1f(c.uniLocs.genGeo.quadCountSqrtInverse,1/t),o.uniform1f(c.uniLocs.genGeo.flatness,.8),o.useProgram(c.progs.renderGeo),o.uniform1i(c.uniLocs.renderGeo.quadCountSqrt,t),o.uniform1f(c.uniLocs.renderGeo.quadCountSqrtInverse,1/t),o.uniform1i(c.uniLocs.renderGeo.geoTexV0,0),o.uniform1i(c.uniLocs.renderGeo.geoTexV1,1),o.uniform1i(c.uniLocs.renderGeo.geoTexV2,2),o.uniform1i(c.uniLocs.renderGeo.geoTexLookAt,3),o.uniform1f(c.uniLocs.renderGeo.borderZWeight,-.053),o.useProgram(c.progs.dbgTex),o.uniform2fv(c.uniLocs.dbgTex.position,[.1,.6]),o.uniform2fv(c.uniLocs.dbgTex.size,[.2,.2]),o.uniform4fv(c.uniLocs.dbgTex.valueScale,[1,1,1,1]),o.uniform4fv(c.uniLocs.dbgTex.valueShift,[0,0,0,0])};let d;const p=()=>{d=o.createVertexArray(),o.bindVertexArray(d);let e=o.createBuffer(),t=new Uint16Array(6*a);o.bindBuffer(o.ARRAY_BUFFER,e),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),o.vertexAttribIPointer(0,1,o.UNSIGNED_SHORT,0,0),o.enableVertexAttribArray(0)};var T;const g=()=>{T=o.createVertexArray(),o.bindVertexArray(T);let e=o.createBuffer(),t=new Float32Array([-1,-1,1,-1,-1,1,1,1]);o.bindBuffer(o.ARRAY_BUFFER,e),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),o.vertexAttribPointer(0,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(0)};let S,A;let R,D=[];let G=!1,C=Date.now(),_=0,L=0;const B=()=>{let e=(Date.now()-C)/1e3*1;L=e-_,_=e,U(),X(),K(),W(),G||window.requestAnimationFrame(B)};let F=0,N=0,P=0,q=0,I=0;const U=()=>{if(_>q)F=I;else{let e=(_-N)/(q-N);F=e*I+(1-e)*P}};let w=[{name:"decent",duration:1},{name:"vanished",duration:1},{name:"design",duration:1},{name:"build",duration:1},{name:"learn",duration:1},{name:"fadeout",duration:1}];let z={},O={turn:0,yRotate:{v:0,v0:0,t:0,t0:0,angle:0}},V={yRotate:!1};const X=()=>{let e,t,r,a;for(let n of w)r=(t=Math.max(0,Math.min(1,(F-n.begin)/n.duration)))*t*(3-2*t),e=1-Math.pow(t-1,2),a=1-Math.pow(2*r-1,2),z[n.name]={appear:e,lin:t,smooth:r,swell:a};O.turn+=L*(1.5-1.3*z.learn.appear)%Math.PI,O.transformSpin=6*Math.pow(z.build.smooth,2),O.cameraSpread=.4-.32*z.learn.smooth,O.turbulence=.6+.2*Math.pow(z.design.smooth,2),O.shape=z.build.smooth,O.borderSize=.1-.118*z.design.smooth-.045*z.build.swell+.025*z.build.smooth+.1*z.learn.smooth;let n=Math.min(3*z.learn.lin,1);if(n=n*n*(3-2*n),O.cells=n,O.cellSize=50-40*z.learn.smooth,O.fog=1-z.decent.appear+1*z.vanished.smooth+-.9*z.design.smooth-1.8*Math.pow(z.build.lin,2)-z.build.swell,O.cp=[1.2-.2*z.design.smooth+.6*z.build.smooth+.9*z.build.swell,-z.fadeout.smooth,.95-.6*z.design.smooth+.2*z.build.swell],O.la=[0+.1*z.design.smooth,-z.fadeout.smooth,Math.pow(z.build.smooth,1.5)],z.learn.lin>0?V.yRotate||(V.yRotate=!0,O.yRotate.v=0,O.yRotate.t=_):V.yRotate=!1,O.yRotate.t<_)O.yRotate.v0=O.yRotate.v,O.yRotate.v=.25*(O.yRotate.v0+3*(2*Math.random()-1.2)*Math.PI),O.yRotate.t0=_,O.yRotate.t=_+.8*(Math.random()+2)*(Math.abs(O.yRotate.v0-O.yRotate.v)+.5);else{let e=Math.min(1,(_-O.yRotate.t0)/(O.yRotate.t-O.yRotate.t0)*2.2);e=(e=.5-.5*Math.cos(e*Math.PI))*e*(3-2*e),O.yRotate.angle=O.yRotate.v0*(1-e)+O.yRotate.v*e}O.yRotate.finalAngle=z.learn.smooth*O.yRotate.angle};let H=512;const K=()=>{let t=e.clientHeight,r=Math.min(t,4096);H!=r&&(H=r,e.width=r,e.height=r)},W=()=>{Y(),Z(),k(),ue()},Y=()=>{o.bindFramebuffer(o.FRAMEBUFFER,o.NULL),o.viewport(0,0,H,H),o.clearColor(1,1,1,0),o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT)},Z=()=>{o.bindFramebuffer(o.FRAMEBUFFER,A),o.viewport(0,0,r,r),o.useProgram(c.progs.genPlasma),o.uniform1f(c.uniLocs.genPlasma.time,_),o.uniform1f(c.uniLocs.genPlasma.turbulence,O.turbulence),o.bindVertexArray(T),o.drawArrays(o.TRIANGLE_STRIP,0,4)},k=()=>{o.bindFramebuffer(o.FRAMEBUFFER,R),o.viewport(0,0,2*t,t),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1,o.COLOR_ATTACHMENT2,o.COLOR_ATTACHMENT3]),o.useProgram(c.progs.genGeo);let e=[];n.lookAt(e,O.cp,O.la,[0,1,0]),o.uniformMatrix4fv(c.uniLocs.genGeo.camera,!1,e),o.uniform1f(c.uniLocs.genGeo.cameraSpread,O.cameraSpread),o.uniform1f(c.uniLocs.genGeo.shape,O.shape),ie(),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,S),o.bindVertexArray(T),o.drawArrays(o.TRIANGLE_STRIP,0,4)},Q=Math.sqrt(.75),J=Math.PI-Math.acos(1/3),j=n.create();j[0]=Q,j[1]=.5;const $=[],ee=[];n.fromTranslation($,[0,-1,0,0]),n.invert(ee,$);const te=[];te[0]=[Q,-.5,0,0],te[1]=[0,-1,0,0],te[2]=[-Q,.5,0,0];const re=[];n.fromScaling(re,[.5,.5,.5,1]);const ae=[];n.fromTranslation(ae,[.3333*Q,-.5,-.1,0]);const ne=[];n.mul(ne,re,ae);const oe=n.create();oe[10]=-1,oe[0]=-1;const ie=()=>{let e=n.clone(j);e[13]=1;let t=[[],[],[]];for(let e=0;e<3;e++)n.fromRotation(t[e],O.shape*-J,te[e]);n.mul(t[0],t[0],$),n.mul(t[0],ee,t[0]);let r=[[],[]];n.fromZRotation(r[0],.5*(O.transformSpin+1.3*O.turn-Math.sin(.55*O.turn))),n.fromZRotation(r[1],-.3*(O.transformSpin+2.1*O.turn-Math.sin(.81*O.turn)));let a=[];n.fromYRotation(a,O.yRotate.finalAngle);let i=[];n.fromTranslation(i,[0,0,O.shape,0]);let u,s=[];for(let o=0;o<2;o++){s[o]=[];for(let l=0;l<2;l++){s[o][l]=[];for(let c=0;c<2;c++)u=0==l?n.clone(e):n.clone(j),1==o?(1==c&&n.mul(u,t[0],u),n.mul(u,t[1],u)):0==c&&n.mul(u,t[2],u),n.mul(u,ne,u),n.mul(u,r[l],u),0==l&&n.mul(u,oe,u),n.mul(u,a,u),n.mul(u,i,u),s[o][l][c]=u}}o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide00A,!1,s[0][0][0]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide00B,!1,s[0][0][1]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide10A,!1,s[1][0][0]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide10B,!1,s[1][0][1]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide01A,!1,s[0][1][0]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide01B,!1,s[0][1][1]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide11A,!1,s[1][1][0]),o.uniformMatrix4fv(c.uniLocs.genGeo.prismSide11B,!1,s[1][1][1])},ue=()=>{o.bindFramebuffer(o.FRAMEBUFFER,o.NULL),o.viewport(0,0,H,H),o.useProgram(c.progs.renderGeo),o.uniform1f(c.uniLocs.renderGeo.pixelSize,2/H),o.uniform1f(c.uniLocs.renderGeo.resolution,H),o.uniform1f(c.uniLocs.renderGeo.borderSize,O.borderSize),o.uniform1f(c.uniLocs.renderGeo.cells,O.cells),o.uniform1f(c.uniLocs.renderGeo.cellSize,O.cellSize),o.uniform1f(c.uniLocs.renderGeo.fog,O.fog),o.uniform1f(c.uniLocs.renderGeo.resolutionInverse,1/H);for(let e=0;e<4;e++)o.activeTexture(i[e]),o.bindTexture(o.TEXTURE_2D,D[e]);o.enable(o.DEPTH_TEST),o.bindVertexArray(d),o.drawArrays(o.TRIANGLES,0,6*a),o.disable(o.DEPTH_TEST)};return(()=>{if(!(o=e.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!1})))return console.error("subtile3d: could not get webgl2 content"),!1;for(let e of[o.TEXTURE0,o.TEXTURE1,o.TEXTURE2,o.TEXTURE3])i.push(e);for(let e of[o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1,o.COLOR_ATTACHMENT2,o.COLOR_ATTACHMENT3])s.push(e);return o.getExtension("EXT_color_buffer_float")?!!o.getExtension("OES_texture_float_linear")||(console.error("subtile3d: need gl extension OES_texture_float_linear"),o=void 0,!1):(console.error("subtile3d: need gl extension EXT_color_buffer_float"),o=void 0,!1)})()?(setTimeout(()=>{(()=>{let e=0;for(let t of w)t.begin=e,e+=t.duration})(),m(),p(),g(),S=o.createTexture(),o.bindTexture(o.TEXTURE_2D,S),o.texImage2D(o.TEXTURE_2D,0,o.RGBA32F,r,r,0,o.RGBA,o.FLOAT,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),A=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,A),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,S,0),(()=>{var e=()=>{var e=o.createTexture();return o.bindTexture(o.TEXTURE_2D,e),o.texImage2D(o.TEXTURE_2D,0,o.RGBA32F,2*t,t,0,o.RGBA,o.FLOAT,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),e};R=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,R);for(var r=0;r<4;r++)D[r]=e(),o.framebufferTexture2D(o.FRAMEBUFFER,s[r],o.TEXTURE_2D,D[r],0)})(),B()}),{setAnimProgress:(e,t)=>{P=F,N=_,q=_+(t=t||0),I=e},quit:()=>{G=!0}}):void 0}r.d(t,"useCanvas",(function(){return Ae})),a.setMatrixArrayType(Array)}]);